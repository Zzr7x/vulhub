FROM vulhub/httpd:2.4.43

LABEL maintainer="phithon <root@leavesongs.com>"

COPY ./secret.txt /usr/local/apache2/htdocs
RUN set -ex \
    && sed -i "s|#LoadModule proxy_module modules/mod_proxy.so|LoadModule proxy_module modules/mod_proxy.so|g" /usr/local/apache2/conf/httpd.conf \
    && sed -i "s|#LoadModule proxy_http_module modules/mod_proxy_http.so|LoadModule proxy_http_module modules/mod_proxy_http.so|g" /usr/local/apache2/conf/httpd.conf \
    && sed -i "s|#LoadModule rewrite_module modules/mod_rewrite.so|LoadModule rewrite_module modules/mod_rewrite.so|g" /usr/local/apache2/conf/httpd.conf \
    && sed -i "s|#Include conf/extra/httpd-vhosts.conf|Include conf/extra/httpd-vhosts.conf|g" /usr/local/apache2/conf/httpd.conf \
    && { \
        echo '<VirtualHost *>'; \
        echo '  ServerAdmin webmaster@localhost'; \
        echo '  ServerName localhost'; \
        echo '  DocumentRoot /usr/local/apache2/htdocs'; \
        echo ; \
        echo '  RewriteEngine on'; \
        echo '  RewriteRule "^/vuln/(.*)$" "http://apache/xxx?$1" [P]'; \
        echo '  ProxyPassReverse /here/ http://apache/'; \
        echo '</VirtualHost>'; \
    } > /usr/local/apache2/conf/extra/httpd-vhosts.conf
